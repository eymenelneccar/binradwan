<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crafty Burger</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Cairo) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @font-face {
            font-family: 'MSjawhara';
            src: url('MSjawhara-Bold.ttf') format('truetype');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        body {
            font-family: 'Cairo', 'MSjawhara', sans-serif;
            background-color: #0a0a0a;
            color: white;
        }

        /* Hide Scrollbar */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Custom Neon Text Shadow */
        .neon-text {
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }
    </style>
</head>
<body class="pb-40">

    <!-- Header -->
    <header id="main-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 py-5 bg-transparent">
        <div class="container mx-auto px-4">
            <div class="relative flex items-center justify-center">
                <div class="flex items-center gap-1">
                    <span class="text-2xl font-black tracking-tighter text-white">CRAFTY</span>
                    <span class="text-2xl font-black tracking-tighter text-[#FFC107]">BURGER</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="relative h-[40vh] w-full overflow-hidden">
        <!-- Background Image -->
        <div class="absolute inset-0 z-0">
            <img src="https://images.unsplash.com/photo-1552566626-52f8b828add9?q=80&w=2070&auto=format&fit=crop" 
                 alt="Neon Restaurant Interior" 
                 class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-[#0a0a0a]/80 to-transparent"></div>
        </div>

        <!-- Content -->
        <div class="relative z-10 h-full flex flex-col justify-end items-center text-center px-4 pb-12">
            <h1 id="hero-title" class="text-3xl md:text-5xl font-black mb-2 leading-tight">
                فن الشارع في <span class="text-[#FFC107]">كل قضمة</span>
            </h1>
        </div>
    </div>

    <!-- Categories Section -->
    <div class="sticky top-20 z-40 bg-gradient-to-b from-transparent via-[#0a0a0a]/80 to-[#0a0a0a] pt-2 pb-4 mb-4 -mt-8">
        <div class="container mx-auto px-4 overflow-x-auto hide-scrollbar">
            <div id="categories-container" class="flex justify-center gap-4 min-w-max pb-2 pt-2">
                <!-- Categories will be injected here via JS -->
            </div>
        </div>
    </div>

    <!-- Products Grid -->
    <div class="container mx-auto px-4 pb-12">
        <!-- Grid set to 2 columns on mobile (grid-cols-2) -->
        <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
            <!-- Products will be injected here via JS -->
        </div>
    </div>

    <!-- Fixed Footer -->
    <footer class="fixed bottom-0 left-0 right-0 bg-black/95 backdrop-blur border-t border-gray-900 py-4 z-40">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 font-medium text-sm mb-1">
                © 2025 جميع الحقوق محفوظة لصالح <span class="text-[#FFC107] font-bold">Graffiti Burger</span>
            </p>
            <p class="text-gray-600 text-xs font-light tracking-wide" dir="ltr">
                powered by <span class="text-gray-500 font-bold hover:text-white transition-colors cursor-default">IQR .LTD</span>
            </p>
        </div>
    </footer>

    <!-- Floating Cart Button -->
    <div class="fixed bottom-24 left-6 z-50">
        <button onclick="shakeCart()" class="w-16 h-16 bg-[#FFC107] rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(255,193,7,0.4)] hover:scale-110 transition-transform relative">
            <i data-lucide="shopping-cart" class="text-black w-6 h-6"></i>
            <span id="cart-badge" class="hidden absolute -top-1 -right-1 bg-[#E91E63] text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border-2 border-[#0a0a0a]">
                0
            </span>
        </button>
    </div>

    <!-- JavaScript Logic -->
    <script>
        let activeCategory = 'الكل';
        let cartCount = 0;
        let APP = { categories: [], items: [] };

        window.GH_OWNER = window.GH_OWNER || '';
        window.GH_REPO = window.GH_REPO || '';
        window.GH_BRANCH = window.GH_BRANCH || 'main';
        const isGhEnabled = () => Boolean(window.GH_OWNER && window.GH_REPO);
        const ghUrls = (path) => {
            const t = Date.now();
            const p = String(path || '').replace(/^\//, '');
            return [
                `https://raw.githubusercontent.com/${window.GH_OWNER}/${window.GH_REPO}/${window.GH_BRANCH}/${p}?t=${t}`,
                `https://cdn.jsdelivr.net/gh/${window.GH_OWNER}/${window.GH_REPO}@${window.GH_BRANCH}/${p}?t=${t}`
            ];
        };
        async function initDataRepoConfig() {
            if (isGhEnabled()) return;
            try {
                const resp = await fetch('/api/config');
                if (resp.ok) {
                    const j = await resp.json();
                    if (j && j.ok && j.owner && j.repo) {
                        window.GH_OWNER = j.owner;
                        window.GH_REPO = j.repo;
                        window.GH_BRANCH = j.branch || 'main';
                    }
                }
            } catch {}
        }
        const PHRASE_MAP = {
            'موهيتو ازرق': 'BLUE LAGOON',
            'موهيتو أزرق': 'BLUE LAGOON',
            'قهوة عربية': 'ARABIC COFFEE',
            'ديناميت فرايز': 'DYNAMITE FRIES',
            'دبل ترافل': 'DOUBLE TRUFFLE',
            'الماستر': 'MASTER'
        };
        const WORD_MAP = {
            'الكل':'ALL','برجر':'BURGER','ماستر':'MASTER','دبل':'DOUBLE','ترافل':'TRUFFLE','ديناميت':'DYNAMITE','فرايز':'FRIES','بطاطس':'FRIES','موهيتو':'MOJITO','ازرق':'BLUE','أزرق':'BLUE','مشروب':'DRINK','مشروبات':'DRINKS',
            'قهوة':'COFFEE','كهوة':'COFFEE','شاي':'TEA','نسكافيه':'NESCAFE','كابتشينو':'CAPPUCCINO','لاتيه':'LATTE','اسبرسو':'ESPRESSO','كولا':'COLA','بيبسي':'PEPSI','سبرايت':'SPRITE',
            'عصير':'JUICE','برتقال':'ORANGE','ليمون':'LEMON','نعناع':'MINT','توت':'BERRY','فراولة':'STRAWBERRY','مانجو':'MANGO','اناناس':'PINEAPPLE','أناناس':'PINEAPPLE',
            'لحم':'BEEF','انجوس':'ANGUS','أنجوس':'ANGUS','جبنة':'CHEESE','شيدر':'CHEDDAR','مدخن':'SMOKED','صوص':'SAUCE','هالبينو':'JALAPENO','مشروم':'MUSHROOM','جرجير':'ARUGULA','بريوش':'BRIOCHE','اسود':'BLACK','أسود':'BLACK','كرافتي':'CRAFTY','جرافيتي':'GRAFFITI','كلاسيك':'CLASSIC','سبايسي':'SPICY','كومبو':'COMBO'
        };
        function normalizeArabic(s){return String(s||'').replace(/[\u064B-\u065F\u0670]/g,'').replace(/\u0640/g,'').trim();}
        function arabicToLatin(s){
            const map={'ا':'a','أ':'a','إ':'i','آ':'a','ب':'b','ت':'t','ث':'th','ج':'j','ح':'h','خ':'kh','د':'d','ذ':'dh','ر':'r','ز':'z','س':'s','ش':'sh','ص':'s','ض':'d','ط':'t','ظ':'z','ع':'a','غ':'gh','ف':'f','ق':'q','ك':'k','گ':'g','م':'m','ن':'n','ه':'h','ة':'a','و':'o','ؤ':'o','ي':'y','ى':'a','ئ':'y'};
            return normalizeArabic(s).split('').map(ch=>map[ch]||ch).join('');
        }
        function autoEnglish(s){
            let t=normalizeArabic(s).toLowerCase();
            Object.keys(PHRASE_MAP).forEach(k=>{const kk=normalizeArabic(k).toLowerCase();if(t.includes(kk)){t=t.replace(new RegExp(kk,'g'),PHRASE_MAP[k].toUpperCase());}});
            const tokens=t.split(/\s+/).filter(Boolean).map(tok=>{const noAl=tok.replace(/^ال/,'');const w=WORD_MAP[tok]||WORD_MAP[noAl];return (w||arabicToLatin(noAl)).toUpperCase();});
            const out=tokens.join(' ').replace(/\s+/g,' ').trim();
            return out;
        }
        async function loadJson(path) {
            if (isGhEnabled()) {
                const urls = ghUrls(path);
                for (let i = 0; i < urls.length; i++) {
                    try {
                        const r = await fetch(urls[i], { cache: 'no-store' });
                        if (r.ok) return await r.json();
                    } catch {}
                }
            }
            const r = await fetch(path, { cache: 'no-store' });
            if (!r.ok) throw new Error('failed_to_load_' + path);
            return await r.json();
        }
        function resolveAssetUrl(path) {
            const raw = String(path || '').trim();
            if (!raw) return '';
            if (/^(?:https?:)?\/\//i.test(raw)) return raw;
            if (!isGhEnabled()) return raw;
            const rel = raw.replace(/^\//, '');
            if (!/^assets\//.test(rel)) return raw;
            return `https://raw.githubusercontent.com/${window.GH_OWNER}/${window.GH_REPO}/${window.GH_BRANCH}/${rel}`;
        }

        async function loadCategories() {
            let cats = [];
            try {
                const raw = localStorage.getItem('menu_categories');
                if (raw) {
                    const arr = JSON.parse(raw);
                    if (Array.isArray(arr)) cats = arr.filter(Boolean).map(String);
                }
            } catch {}
            if (!cats.length) {
                try {
                    const data = await loadJson('assets/categories.json');
                    if (Array.isArray(data)) {
                        cats = data.map(c => typeof c === 'string' ? c : (c && c.name) || '').filter(Boolean);
                    }
                } catch {}
            }
            if (!cats.length) {
                const fromItems = Array.from(new Set(APP.items.map(i => String(i.category || '').trim()).filter(Boolean)));
                cats = fromItems;
            }
            const uniq = Array.from(new Set(cats));
            return ['الكل'].concat(uniq);
        }

        async function loadItems() {
            try {
                const data = await loadJson('assets/menu.json');
                if (Array.isArray(data)) {
                    return data.map(d => ({
                        id: d.id,
                        category: String(d.category || '').trim() || 'غير مصنّف',
                        title: d.name || d.title || '',
                        englishTitle: d.englishTitle || autoEnglish(d.name || d.title || ''),
                        price: Number(d.price) || 0,
                        description: d.description || '',
                        image: resolveAssetUrl(d.imageUrl || ''),
                        isNew: !!d.isNew
                    }));
                }
            } catch {}
            return [];
        }

        async function applyHeroFromAssets() {
            try {
                const data = await loadJson('assets/hero.json');
                const imgEl = document.querySelector('.relative.h-[40vh] img');
                const titleEl = document.querySelector('.relative.z-10 h-full h-full .font-black');
                const heroTitle = document.querySelector('#hero-title-text');
                if (data && data.imageUrl && imgEl) imgEl.src = resolveAssetUrl(data.imageUrl);
                if (data && typeof data.title === 'string') {
                    const h1 = document.querySelector('#hero-title');
                    if (h1) h1.innerText = data.title;
                }
            } catch {}
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await initDataRepoConfig();
            APP.items = await loadItems();
            APP.categories = await loadCategories();
            renderCategories();
            renderProducts();
            await applyHeroFromAssets();
            lucide.createIcons();
            window.addEventListener('scroll', () => {
                const header = document.getElementById('main-header');
                if (window.scrollY > 50) {
                    header.classList.remove('bg-transparent', 'py-5');
                    header.classList.add('bg-black/90', 'backdrop-blur-md', 'py-3', 'shadow-lg');
                } else {
                    header.classList.add('bg-transparent', 'py-5');
                    header.classList.remove('bg-black/90', 'backdrop-blur-md', 'py-3', 'shadow-lg');
                }
            });
        });

        // Functions
        function renderCategories() {
            const container = document.getElementById('categories-container');
            const cats = APP.categories;
            container.innerHTML = cats.map(name => {
                const isActive = activeCategory === name;
                const activeClasses = 'bg-[#FFC107] text-black border-[#FFC107] shadow-[0_0_15px_rgba(255,193,7,0.3)] scale-105';
                const inactiveClasses = 'bg-black/60 text-gray-300 border-gray-700 hover:border-gray-500 hover:bg-black/80';
                return `
                    <button onclick="setCategory('${name}')" 
                        class="relative px-8 py-2 md:py-3 rounded-lg font-bold transition-all duration-300 transform -skew-x-12 border backdrop-blur-md ${isActive ? activeClasses : inactiveClasses}">
                        <span class="block transform skew-x-12 text-lg">${name}</span>
                    </button>
                `;
            }).join('');
        }

        function setCategory(categoryName) {
            activeCategory = categoryName;
            renderCategories();
            renderProducts();
            lucide.createIcons(); // Re-render icons for new content
        }

        function renderProducts() {
            const grid = document.getElementById('products-grid');
            const items = activeCategory === 'الكل' ? APP.items : APP.items.filter(p => p.category === activeCategory);
            grid.innerHTML = items.map(item => `
                <div class="bg-[#141414] rounded-3xl overflow-hidden border border-gray-800 hover:border-gray-700 transition-all duration-300 group">
                    <div class="relative h-40 md:h-64 overflow-hidden">
                        <img src="${item.image || ''}" alt="${item.title}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500" onerror="this.style.display='none'">
                        <div class="absolute inset-0 bg-gradient-to-t from-[#141414] to-transparent opacity-80"></div>
                        <div class="absolute bottom-2 right-2 bg-black/90 backdrop-blur px-2 py-1 rounded-lg border border-gray-800">
                            <span class="text-[#FFC107] font-black text-sm md:text-xl">${Number(item.price||0).toLocaleString('ar-IQ')}</span>
                            <span class="text-white text-[10px] md:text-xs mr-1">د.ع</span>
                        </div>
                        ${item.isNew ? `
                        <div class="absolute top-2 right-2 bg-[#E91E63] text-white text-[10px] md:text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                            جديد
                        </div>` : ''}
                    </div>
                    <div class="p-4 md:p-6 relative -mt-4 md:-mt-6 bg-[#141414] rounded-t-3xl">
                        <h3 class="text-lg md:text-2xl font-black text-white leading-tight mb-1 md:mb-2">${item.title}</h3>
                        <h4 class="text-[#E91E63] text-[10px] md:text-xs font-bold tracking-widest uppercase mb-2 md:mb-4 opacity-90 truncate">${item.englishTitle || ''}</h4>
                        <p class="text-gray-400 text-xs md:text-sm leading-relaxed mb-4 md:mb-6 font-medium line-clamp-2 md:line-clamp-none">${item.description || ''}</p>
                        <button onclick="addToCart()" class="w-full bg-[#1a1a1a] hover:bg-[#252525] text-white py-2 md:py-4 rounded-xl font-bold flex items-center justify-center gap-2 group transition-colors border border-gray-800 text-sm md:text-base cursor-pointer">
                            <span>أضف</span>
                            <i data-lucide="plus" class="text-[#FFC107] w-4 h-4 group-hover:rotate-90 transition-transform"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart() {
            cartCount++;
            const badge = document.getElementById('cart-badge');
            badge.innerText = cartCount;
            badge.classList.remove('hidden');
            badge.classList.add('flex');
            shakeCart();
        }

        function shakeCart() {
            const btn = document.querySelector('.fixed.bottom-24 button');
            btn.classList.add('scale-125');
            setTimeout(() => {
                btn.classList.remove('scale-125');
            }, 200);
        }
    </script>
</body>
</html>
